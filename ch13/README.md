# 13장 리액트 라우터로 SPA 개발하기

## 13.1 SPA란 ?

- SAP는 Single Page Application의 약어. 말 그대로 한 개의 페이지로 이루어진 애플리케이션을 말한다.
- 요즘은 웹에서 제공되는 정보가 많기 때문에 새로운 화면을 보여 주어야 할 때마다 서버 측에서 모든 뷰를 준비한다면 성능상의 문제가 발생할 수 있다. 따라서 **사용자와의 인터렉션이 자주 발생하는 모던 웹 애플리케이션에는 적당하지 않을 수 있다.**
- 리액트 같은 라이브러리 혹은 프레임워크를 사용하여 뷰 렌더링을 사용자의 브라우저가 담당하도록 하고, 우선 애플리케이션을 브라우저에 불러와서 실행시킨 후에 사용자와의 인터랙션이 발생하면 필요한 부분만 자바스크립트를 사용하여 업데이트 한다.
- 싱글 페이지라고 해서 화면이 한 종류인것만은 아니다. 서버에서 사용자에게 제공하는 페이지는 한 종류이지만, 해당 페이지에서 로딩된 자바스크립트와 현재 사용자 브라우저의 주소 상태에 따라 다양한 화면을 보여줄 수 있다.
- **다른 주소에 다른 화면을 보여 주는 것을 라우팅이라고 한다.**

### 13.1.1 SPA의 단점

- 앱의 규모가 커지면 자바스크립트 파일이 너무 커진다.
- 페이지 로딩 시 사용자가 실제로 방문하지 않을 수도 있는 페이지의 스크립트도 불러오기 때문이다.
- 이는 코드 스플리팅(code splitting)을 사용하면 라우트별로 파일들을 나누어서 트래픽과 로딩 속도를 개선할 수 있다.

## 13.2 프로젝트 준비 및 기본적인 사용법

### 13.2.1 라이브러리 설치 및 라우터 적용.

라이브러리 설치

```
yarn add react-router-dom
```

- 프로젝트에 리액트 라우터를 적용할 때는 src/index.js 파일에서 react-router-dom에 내장되어 있는 BrowserRouter 라는 컴포넌트를 사용하여 감싸면 된다.

### 13.2.3 페이지 만들기

- 라우트로 사용할 페이지인 Home.js 와 About.js 를 만듬.

### 13.2.4 Route 컴포넌트로 특정 주소에 컴포넌트 연결

- Route 컴포넌트를 사용하면 어떤 규칙을 가진 경로에 어떤 컴포넌트를 보여 줄지 정의할 수 있다.

```
<Route path="주소 규칙" component={보여 줄 컴포넌트} />
```

#### 문제점

/about 경로로 들어가면 About 컴포넌트만 나오기를 기대했지만, /about 경로가 / 규칙에도 일치하기 때문에 Home 컴포넌트도 같이 나온다.<br />
이는 Home을 위한 Route 컴포넌트를 사용할 때 exact라는 props를 true로 설정하면 된다.

### 13.2.5 Link 컴포넌트를 사용하여 다른 주소로 이동하기

- 클릭하면 다른 주소로 이동시켜 주는 컴포넌트.
- 페이지를 새로 불러오지 않고 애플리케이션은 그대로 유지한 상태에서 페이지의 주소만 변경해 준다. 페이지 전환에 의해 렌더링 된 컴포넌트들을 사라지게 하지 않는다.

```
<Link to="주소">내용</Link>
```

## 13.3 Route 하나에 여러 개의 path 설정하기

- Route를 두 번 사용하는 대신, path props를 배열로 설정해 주면 여러 경로에서 같은 컴포넌트를 보여 줄 수 있다.

## 13.4 URL 파라미터와 쿼리

유동적인 값을 사용하는 상황에서 파라미터나 쿼리를 사용한다. 일반적으로 **특정 아이디 혹은 이름을 사용하여 조회할 때 파라미터를 사용하고, 쿼리는 우리가 어떤 키워드를 검색하거나 페이지에 필요한 옵션을 전달할 때 사용한다.**

- 파라미터 예시: /profiles/velopert
- 쿼리 예시: /about?details=true

### 13.4.1 URL 파라미터

`/profile/velopert` 와 같은 형식으로 뒷부분에 유동적인 username값을 넣어 줄 때 해당 값을 props로 받아 와서 조회하도록 한다.

- URL 파라미터를 사용할 때는 라우트로 사용되는 컴포넌트에서 받아 오는 `match`라는 객체 안의 `params` 값을 참조한다.
- `match` 객체 안에는 현재 컴포넌트가 어떤 경로 규칙에 의해 보이는지에 대한 정보가 들어 있다.
- Route의 path 규칙에 `/profiles/:username` 을 적용하면 `match.params.username` 값을 통해 현재 username 값을 조회할 수 있다.

### 13.4.2 URL 쿼리

About 페이지에서 쿼리를 받아 온다.

- 쿼리는 `location` 객체에 들어 있는 `search` 값에서 조회할 수 있다.
- `location` 객체는 라우트로 사용된 컴포넌트에게 props로 전달되며, 웹 애플리케이션의 현재 주소에 대한 정보를 지니고 있다.

#### location의 형태

`http://localhost:3000/about/?detail=true` 로 들어갔을 때.

```
{
  "pathname": "/about",
  "search": "?detail=true",
  "hash": ""
}
```

여기서 문자열 형태로 되어 있는 search값을 확인해야 하는데, 여기서 특정 값을 얻기 위해서는 이 문자열을 객체 형태로 변환해 주어야 한다. 이때 사용하는 라이브러리가 `qs` 라이브러리 이다.

```
yarn add qs
```

쿼리 문자열을 객체로 파싱하는 과정에서 얻은 결과 값은 언제나 문자열이다.

## 13.5 서브 라우트

라우트 내부에 또 라우트를 정의하는 것.<br />

- 프로필 링크를 보여주는 `Profiles`라는 라우트 컴포넌트를 따로 만들고, 그 안에서 Profile 컴포넌트를 서브 라우트로 사용하도록 함.
- `Profiles.js` 에서 첫 번째 Route 컴포넌트에는 component 대신 render 라는 props를 넣어 줬다. 컴포넌트 자체를 전달하는 것이 아닌 보여주고 싶은 JSX를 넣어 줄 수도 있다.
- JSX에서 props를 설정할 때 값을 생략하면 자동으로 true가 된다. `exact={true}`와 같은 의미이다.

## 13.6 리액트 라우터 부가 기능

### 13.6.1 history

- `history` 객체는 라우트로 사용된 컴포넌트에 `match, location`과 함께 전달되는 props중 하나.
- 컴포넌트 내에 구현하는 메서드에서 라우트 API를 호출할 수 있다.
- 특정 버튼을 눌렀을 때 뒤로 가거나, 로그인 후 화면을 전환하거나, 다른 페이지로 이탈하는 것을 방지해야 할 때 history를 활용한다.

### 13.6.2 withRouter

- withRouter 함수는 Hoc(Higher-order Component) 이다.
- 라우트로 사용된 컴포넌트가 아니어도 match, location, history 객체를 접근할 수 있게 해 준다.

#### 사용법

- withRouter를 사용할 땐 컴포넌트를 내보내 줄 때 함수로 감싸 준다.
- `JSON.stringify(value[, replacer[, space]])` 는 value 값을 JSON 문자열로 변환한다. 매개변수로 null과 2를 넣으면 들여쓰기를 포함한 문자열을 반환 한다.
- withRouter를 사용하면 현재 자신을 보여 주고 있는 라우트 컴포넌트(이전: Profiles) 를 기준으로 match가 전달된다. Profiles를 위한 라우트를 설정할 때는 `path="/profiles"`라고만 입력했으므로 username 파라미터를 읽어 오지 못하는 상태이기 떄문이다.
- 따라서 Profiles 에서 Profile 컴포넌트에 넣으면 제대로 나온다.

### 13.6.3 Switch

Switch 컴포넌트는 여러 Route를 감싸서 그 중 일치하는 단 하나의 라우트만을 랜더링 시켜준다.<br />

### 13.6.4 NavLink

현재 경로와 Link에서 사용하는 경로가 일치하는 경우 특정 스타일 혹은 CSS 클래스를 적용할 수 있는 컴포넌트.<br />

- NavLink에서 링크가 활성화되었을 때의 스타일을 적용할 때는 activeStyle 값을, CSS 클래스를 적용할 때는 activeClassName 값을 props로 넣어 주면 된다.
